{% set docker_options = ['--tty', '--log-driver=journald', '--name', container.key ] %}
{% if container.value.ports is defined %}
{% for port in container.value.ports %}
{% do docker_options.extend(['-p', port]) %}
{% endfor %}
{% endif %}
{% if _volumes is defined %}
{% for volume in _volumes %}
{% do docker_options.extend(['-v', volume]) %}
{% endfor %}
{% endif %}
{% if container.value.user is defined %}
{% do docker_options.extend(['-u', container.value.user]) %}
{% endif %}
[Unit]
Description={{Â container.key }}

[Service]
Restart=on-failure
RestartSec=10
ExecStartPre=-/usr/bin/docker rm --force {{ container.key }}
ExecStart=/usr/bin/docker run {{ docker_options|join(' ') }} {{ container.value.image_name }} {{ container.value.command }} 
ExecStop=-/usr/bin/docker stop {{ container.key }}

[Install]
WantedBy=multi-user.target

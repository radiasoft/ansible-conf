{% set docker_options = ['--tty', '--log-driver=journald'] %}

{% if container.value.ports is defined %}
{% for port in container.value.ports %}
{% set docker_options = docker_options + ['-p', port] %}
{% endfor %}
{% endif %}

{% if container.value.volumes is defined %}
{% for volume in container.value.volumes %}
{% set docker_options = docker_options + ['-v', volume] %}
{% endfor %}
{% endif %}

{% if container.value.user is defined %}
{% set docker_options = docker_options + ['-u', container.value.user] %}
{% endif %}

[Unit]
Description={{Â container.key }}

[Service]
Restart=on-failure
RestartSec=10
ExecStartPre=-/usr/bin/docker rm --force {{ container.key }}
ExecStart=/usr/bin/docker run {{ docker_options|join(' ') }} --name {{ container.key }} {{ container.value.image_name }} {{ container.value.command }} 
ExecStop=-/usr/bin/docker stop {{ container.key }}

[Install]
WantedBy=multi-user.target

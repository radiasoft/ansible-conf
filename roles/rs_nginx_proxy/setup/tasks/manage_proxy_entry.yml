---
# TODO: htpasswd should have a more stringent mode
# but because of limitations with the nginx container, it
# requires full access
- name: nginx auth info for {{ proxy.name }}
  htpasswd:
    group: root
    mode: 0644
    name: "{{ item.key }}"
    owner: root
    password: "{{ item.value }}"
    path: "{{ nginx.auth_d }}/{{ proxy.name }}"
  with_dict: "{{ proxy.auth }}"
  when: proxy.auth is defined
  no_log: yes

- name: nginx config for {{Â proxy.name }}
  template:
    dest: "{{ nginx.conf_d }}/{{ proxy.name }}.conf"
    group: root
    mode: 0640
    owner: root
    src: nginx_conf.jinja

